sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/date/UI5Date","sap/ui/layout/ResponsiveFlowLayoutData","sap/m/Input","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/format/DateFormat"],function(t,e,i,o,a,n,r,s,d,l,u){"use strict";var g;var p={};var c;let h;return t.extend("project1.controller.mainView",{onInit:function(){c=this.getOwnerComponent().getModel();g=this;var t=this.getOwnerComponent().getRouter();t.getRoute("RouteMainView").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(t){var e=this;var i=t.getParameter("arguments");h=i.index},setProductType:function(t){var e=t.getSource().getTitle();this.model.setProperty("/productType",e);this.byId("ProductStepChosenType").setText("Chosen product type: "+e);this._wizard.validateStep(this.byId("ProductTypeStep"))},setProductTypeFromSegmented:function(t){var e=t.getParameters().item.getText();this.model.setProperty("/productType",e);this._wizard.validateStep(this.byId("ProductTypeStep"))},additionalInfoValidation:function(){var t=this.byId("ProductName").getValue();var e=parseInt(this.byId("ProductWeight").getValue());if(isNaN(e)){this._wizard.setCurrentStep(this.byId("ProductInfoStep"));this.model.setProperty("/productWeightState","Error")}else{this.model.setProperty("/productWeightState","None")}if(t.length<6){this._wizard.setCurrentStep(this.byId("ProductInfoStep"));this.model.setProperty("/productNameState","Error")}else{this.model.setProperty("/productNameState","None")}if(t.length<6||isNaN(e)){this._wizard.invalidateStep(this.byId("ProductInfoStep"))}else{this._wizard.validateStep(this.byId("ProductInfoStep"))}},optionalStepActivation:function(){i.show("This event is fired on activate of Step3.")},optionalStepCompletion:function(){i.show("This event is fired on complete of Step3. You can use it to gather the information, and lock the input data.")},pricingActivate:function(){this.model.setProperty("/navApiEnabled",true)},pricingComplete:function(){this.model.setProperty("/navApiEnabled",false)},scrollFrom4to2:function(){this._wizard.goToStep(this.byId("ProductInfoStep"))},goFrom4to3:function(){if(this._wizard.getProgressStep()===this.byId("PricingStep")){this._wizard.previousStep()}},goFrom4to5:function(){if(this._wizard.getProgressStep()===this.byId("PricingStep")){this._wizard.nextStep()}},wizardCompletedHandler:function(){this._oNavContainer.to(this.byId("wizardReviewPage"))},backToWizardContent:function(){this._oNavContainer.backToPage(this._oWizardContentPage.getId())},editStepOne:function(){this._handleNavigationToStep(0)},editStepTwo:function(){this._handleNavigationToStep(1)},editStepThree:function(){this._handleNavigationToStep(2)},editStepFour:function(){this._handleNavigationToStep(3)},_handleNavigationToStep:function(t){var e=function(){this._wizard.goToStep(this._wizard.getSteps()[t]);this._oNavContainer.detachAfterNavigate(e)}.bind(this);this._oNavContainer.attachAfterNavigate(e);this.backToWizardContent()},_handleMessageBoxOpen:function(t,e){o[e](t,{actions:[o.Action.YES,o.Action.NO],onClose:function(t){if(t===o.Action.YES){this._handleNavigationToStep(0);this._wizard.discardProgress(this._wizard.getSteps()[0])}}.bind(this)})},_setEmptyValue:function(t){this.model.setProperty(t,"n/a")},productWeighStateFormatter:function(t){return isNaN(t)?"Error":"None"},discardProgress:function(){this._wizard.discardProgress(this.byId("ProductTypeStep"));var t=function(e){for(var i=0;i<e.length;i++){if(e[i].setValue){e[i].setValue("")}if(e[i].getContent){t(e[i].getContent())}}};this.model.setProperty("/productWeightState","Error");this.model.setProperty("/productNameState","Error");t(this._wizard.getSteps())},onFragmentInputChange:function(t){if(t===undefined)return;var e=t.getSource().getName();var i=t.getSource().getValue();if(e!==undefined){if(e==="content"){this.getView().getModel("quizDetail").setProperty("/fragmentData/"+e,i)}else if(e==="noOfOptions"){var o=this.getView().getModel("quizDetail").getProperty("/fragmentData/options");var a=o.length;if(i>a){for(let t=a;t<i;t++){o.push({option:"",correctOption:false})}}else{o=o.slice(0,i)}this.getView().getModel("quizDetail").getProperty("/fragmentData/options",o);this.getView().getModel("quizDetail").setProperty("/fragmentData/"+e,i)}else{this.getView().getModel("quizDetail").setProperty("/fragmentData/options/"+e+"/option",i)}}},getDialog:function(){var t=g.getView();if(!this.dialog){this.dialog=sap.ui.xmlfragment("idFragment","project1.fragments.AddQuestion",this);t.addDependent(g.dialog)}return this.dialog},onPressAddQuestion:function(){var t={noOfOptions:2,content:"",options:[{option:"",correctOption:false},{option:"",correctOption:false}]};this.getView().getModel("quizDetail").setProperty("/fragmentData",t);var e=this.getView().getModel("quizDetail").getData().questions;var i=e?e.length:0;this.getView().getModel("quizDetail").setProperty("/editQuestionIndex",`/questions/${i}`);this.getDialog().open()},onPressEditQuestion:function(t){var e=t.getSource().getBindingContext("quizDetail").getPath();var i=this.getView().getModel("quizDetail").getProperty(e);this.getView().getModel("quizDetail").setProperty("/editQuestionIndex",e);if(i!==undefined){this.getView().getModel("quizDetail").setProperty("/fragmentData",JSON.parse(JSON.stringify(i)))}this.getDialog().open()},onSave:function(t){var e=this.getView().getModel("quizDetail").getProperty("/editQuestionIndex");var i=this.getView().getModel("quizDetail").getProperty("/fragmentData");if(!this.getView().getModel("quizDetail").getProperty("/questions"))this.getView().getModel("quizDetail").setProperty("/questions",[]);this.getView().getModel("quizDetail").setProperty(e,i);this.closeDialog()},closeDialog:function(){this.getView().getModel("quizDetail").setProperty("/fragmentData",null);this.getDialog().close()},onSelectionChange:function(t){this.selectedPaths=t.getSource().getSelectedContextPaths();console.log(this.selectedPaths)},onDeleteQuestion:function(t){this.selectedPaths=this.selectedPaths.map(t=>{var e=parseInt(t.split("/")[2]);return e});var e=this.getView().getModel("quizDetail").getProperty("/questions");var i=[];for(let t=0;t<e.length;t++){if(!this.selectedPaths.includes(t)){i.push(e[t])}}this.getView().getModel("quizDetail").setProperty("/questions",i);this.byId("idQuestionsTable").removeSelections()},onDraftButtonPress:function(t){this.getView().getModel("quizDetail").setProperty("/draft",true);this.handleWizardSave()},onCancelButtonPress:function(){this._handleMessageBoxOpen("Are you sure you want to cancel your report?","warning")},onSaveButtonPress:function(t){this.getView().getModel("quizDetail").setProperty("/draft",false);this.handleWizardSave()},handleWizardSave:async function(){var t=this;var e=this.getView().getModel("quizDetail").getData();delete e.fragmentData;delete e.editQuestionIndex;e.noOfQues=parseInt(e.noOfQues);e.fullMarks=parseInt(e.fullMarks);e.passMarks=parseInt(e.passMarks);e.learningSP=e.learningSP.substring(0,10);e.learningEP=e.learningEP.substring(0,10);if(e.ID){await $.ajax({url:c.getServiceUrl()+"Quiz/"+e.ID,method:"PATCH",contentType:"application/json",data:JSON.stringify(e),success:function(e){t.setMainModel();alert("success")},error:function(t){console.log(t)}})}else{e.date=(new Date).toJSON().slice(0,10);await $.ajax({url:c.getServiceUrl()+"Quiz",method:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){t.setMainModel();alert("success")},error:function(t){console.log(t)}})}},setMainModel:async function(){var t=this;await $.ajax({url:c.getServiceUrl()+"Quiz",method:"GET",contentType:"application/json",success:function(e){t.getView().getModel("localModel").setProperty("/Exam",e.value);t.getView().getModel("localModel").setProperty("/Quiz",e.value)},error:function(t){console.log(t)}})}})});